#################
#### Key Bindings
#################
# Remap prefix to Control + a (primary) and Control + b (secondary)
# Allows both Ctrl-a and Ctrl-b to trigger tmux commands
# Useful for compatibility and flexibility across different workflows
set -g prefix C-a
set -g prefix2 C-b
bind C-a send-prefix
bind C-b send-prefix -2

# Send prefix to nested tmux session with C-a a
# When running tmux inside tmux, press C-a a to send prefix to inner session
bind-key a send-prefix

# Clear scrollback buffer with C-a k
# Useful for clearing terminal history after viewing long logs
bind-key k clear-history

# Make vim ESC key responsive by eliminating escape-time delay
# Default delay causes lag when pressing ESC in vim within tmux
# Setting to 0 makes vim mode switching instant
set -s escape-time 0

# Enable 256 color support in tmux
# Required for proper color display in vim/nvim and other terminal apps
set -g default-terminal "screen-256color"

# Disable automatic window renaming
# Prevents tmux from overriding manual window names based on running process
set-window-option -g automatic-rename off

# Listen to bell alerts from all windows (not just active window)
# Allows notifications from background windows to be heard
set -g bell-action any

# Vim-style keybindings for copy mode
# Enables vi navigation and selection when scrolling through tmux history
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection    # Visual mode selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle   # Visual block mode
bind-key -T copy-mode-vi 'y' send-keys -X copy-selection     # Yank (copy) selection

# Smart pane switching with awareness of vim splits
# This allows seamless navigation between tmux panes and vim splits using Ctrl-hjkl
# Regex pattern matches: vim, vi, nvim, gvim, view, vimdiff (case-insensitive)
# Pattern breakdown: (^|\/) = start or slash, g? = optional 'g', (view|n?vim?) = variants
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"  # Left
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"  # Down
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"  # Up
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"  # Right
bind -n 'C-\' if-shell "$is_vim" "send-keys 'C-\\'" "select-pane -l"  # Last pane

# Reload tmux configuration with C-a r
# Useful for testing changes to this file without restarting tmux
unbind r
bind r source-file ~/.tmux.conf

# Quick pane cycling with C-a C-a
# Press prefix twice to cycle through panes in current window
unbind ^A
bind ^A select-pane -t :.+

# Increase scrollback buffer size to 40,000 lines
# Default is much smaller (~2,000); larger buffer useful for reviewing long logs
# 40,000 lines â‰ˆ 2-4 MB of memory per pane (acceptable for modern systems)
set-option -g history-limit 40000

############
#### Theming
############
# Position status bar at top of screen (default is bottom)
set-option -g status-position top

# Status bar colors (Solarized Dark theme)
# bg=colour235 (dark gray), fg=colour136 (yellow), reverse swaps fg/bg
set-option -g status-style bg=colour235,fg=colour136,reverse

# Inactive window title colors
# colour244 = light gray for inactive windows
set-window-option -g window-status-style fg=colour244,bg=default

# Active window title colors
# colour166 = orange for currently active window
set-window-option -g window-status-current-style fg=colour166,bg=default

# Pane border colors
# colour235 = dark gray for inactive pane borders
# colour240 = medium gray for active pane border (highlighted)
set-option -g pane-border-style fg=colour235
set-option -g pane-active-border-style fg=colour240

# Command/message line colors
# bg=colour235 (dark gray), fg=colour166 (orange) for tmux messages
set-option -g message-style bg=colour235,fg=colour166

# Pane number display colors (shown when pressing prefix + q)
# colour33 = blue for active pane number
# colour166 = orange for inactive pane numbers
set-option -g display-panes-active-colour colour33
set-option -g display-panes-colour colour166

# Clock mode color (shown with prefix + t)
# colour64 = green for tmux clock display
set-window-option -g clock-mode-colour colour64

############
#### Plugins
############
# Tmux Plugin Manager (TPM) configuration
# Install plugins by pressing prefix + I (capital i)
# Update plugins with prefix + U
set -g @tpm_plugins ' \
  tmux-plugins/tpm \
  tmux-plugins/tmux-copycat \
  tmux-plugins/tmux-open \
'

# tmux-copycat: Enhanced search in tmux copy mode
# Ctrl-h searches for SHA1/git commit hashes (5-40 hex characters)
# Regex pattern: \b = word boundary, [0-9a-f] = hex digits, {5,40} = 5 to 40 chars
# Matches both short refs (5-7 chars) and full SHA1 hashes (40 chars)
set -g @copycat_search_C-h '\b[0-9a-f]{5,40}\b'

# Initialize TPM plugin manager
# IMPORTANT: This must be the last line in tmux.conf
# TPM loads and initializes all plugins listed above
run-shell '~/.tmux/plugins/tpm/tpm'
